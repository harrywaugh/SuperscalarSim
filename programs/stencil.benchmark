|fimg 256 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 0 0 0 0 
|ftmp 256 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

.niters 10
.nx 16
.ny 16

main:
	la $a0, fimg
	la $a1, ftmp
	li $a2, 0
	la $t0, niters
	lw $a3, $zero($t0)
	la $t0, ny
	lw $s0, $zero($t0)
	la $t0, nx
	lw $s2, $zero($t0)
	j mainfor

mainfor:
	j stencilcol
	mv $t0, $a0
	mv $a0, $a1
	mv $a1, $t0
	j stencilcol
	addi $a2, $a2, 1
	blt $a2, $a3, -6
	exit

stencilcol:
	mv $t9, $ra
	j stencilrow
	addi $s1, $s1, 1
	blt $s1, $s0, -2
	mv $ra, $t9
	mv $s1, $zero
	return

stencilrow:
	mul $s4, $s2, $s1
	subi $t4, $s2, 1
	lw.f $f0, $s4($a0)
	muli.f $f0, $f0, 6
	beq $s3, $zero, 4
	subi $t3, $s4, 1
	lw.f $f2, $t3($a0)
	add.f $f0, $f0, $f2
	beq $s3, $t4, 4
	addi $t3, $s4, 1
	lw.f $f2, $t3($a0)
	add.f $f0, $f0, $f2
	beq $s1, $zero, 4
	sub $t3, $s4, $s0
	lw.f $f2, $t3($a0)
	add.f $f0, $f0, $f2
	beq $s1, $t4, 4
	add $t3, $s4, $s2
	lw.f $f2, $t3($a0)
	add.f $f0, $f0, $f2
	divi.f $f0, $f0, 10
	sw.f $f0, $s4($a1)
	addi $s4, $s4, 1
	addi $s3, $s3, 1
	blt $s3, $s2, -22
	mv $s3, $zero
	return